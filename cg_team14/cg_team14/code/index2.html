<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <title>Example1</title>

  <style>
    body {
      margin: 0;
    }
    .name-tag {
      position: absolute;
      top: 0px;
      left: 0px;
      cursor: pointer;
      user-select: none;
    }
    .node-names {
      position: absolute;
      width: 1026px;
      height: 1026px;
      top: 0;
      left: 0;
      overflow: hidden;
    }
  </style>

  <script id="vertex-shader" type="x-shader/x-vertex">
    attribute highp vec4 aPosition;
    attribute highp vec3 aNormal;
    // attribute highp vec4 aColor;
    varying highp vec4 fColor;
    varying mediump vec4 color;

    uniform float uUseTexture;
    varying float vUseTexture;
    attribute highp vec2 aTexCoord;
    varying highp vec2 vTexCoord;

    uniform vec4 lightPosition;
    uniform vec4 aColor;
    uniform vec4 ambientProduct, diffuseProduct, specularProduct;
    uniform float shininess;

    uniform mediump mat4 Mmatrix;
    uniform mediump mat4 uModelViewMatrix;
    uniform mat4 uProjectionMatrix;

    void main() {
      gl_PointSize = 1.0;
      gl_Position = uProjectionMatrix * uModelViewMatrix * Mmatrix * aPosition;


      vec3 objtPos = (Mmatrix * aPosition).xyz;
      vec3 viewPos = (uModelViewMatrix * Mmatrix * aPosition).xyz;

      vec3 light = lightPosition.xyz;

      vec3 L = normalize(light - objtPos);
      vec3 E = normalize(-viewPos);
      vec3 H = normalize(L + E);

      vec4 NN = vec4(aNormal, 0);

      vec3 N = normalize((Mmatrix * NN).xyz);

      vec4 ambient = ambientProduct;
      
      float d_val = max(dot(L, N), 0.0);
      vec4 diffuse = d_val * diffuseProduct;

      float s_val = pow(max(dot(N, H), 0.0), shininess);
      vec4 specular = s_val * specularProduct;

      if (dot(L, N) < 0.0) {
        specular = vec4(0.0, 0.0, 0.0, 1.0);
      }

      fColor = ambient + diffuse + specular;
      fColor.a = 1.0;
      color = aColor;

      vTexCoord = aTexCoord;
      vUseTexture = uUseTexture;
    }
  </script>

  <script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;

    varying highp vec4 fColor;
    varying mediump vec4 color;

    varying float vUseTexture;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;

    void main()
    {
      if (vUseTexture < 0.5) {
        gl_FragColor = (color * 0.4) + (color * fColor * 0.6);
      } else {
        gl_FragColor = (texture2D(uTexture, vTexCoord) * 0.4) + (texture2D(uTexture, vTexCoord) * fColor * 0.6);
      }
    }
</script>

  <script type="text/javascript" src="webgl-utils.js"></script>
  <script type="text/javascript" src="initShaders.js"></script>
  <script type="text/javascript" src="MV.js"></script>
  <script type="text/javascript" src="Math.js"></script>
  <script type="text/javascript" src="imgSrc.js"></script>
  <script type="text/javascript" src="shapes.js"></script>
  <script type="text/javascript" src="renderObjectInfo.js"></script>
  <script type="text/javascript" src="ctrl.js"></script>
  <script type="text/javascript" src="glw3.js"></script>
</head>

<body>
  <div style="display: flex;">
    <canvas id="gl-canvas" width="1024" height="1024" style="border: 1px solid #000;">
      Oops ... your browser doesn't support the HTML5 canvas element
    </canvas>
    <div id="ctrl-panel" style="margin-left: 20px; margin-top: 20px; display: none;">
      <div style="display: flex; align-items: center;">
        <h1 id="sltd-name" style="margin-right: 10px;">
        </h1>
        <button style="height: 30px;" onclick="removeNode(sltd)" id="remove-btn">
          remove node
        </button>
      </div>
      <div>
        rotation 조절
        <div>
          <input id="rotXD-N" type="number">
          <input id="rotXS-N" type="range" min="-6.28" max="6.28" step="0.01">
          <input id="rotXS-SPD" type="number">
        </div>
        <div>
          <input id="rotYD-N" type="number">
          <input id="rotYS-N" type="range" min="-6.28" max="6.28" step="0.01">
          <input id="rotYS-SPD" type="number">
        </div>
        <div>
          <input id="rotZD-N" type="number">
          <input id="rotZS-N" type="range" min="-6.28" max="6.28" step="0.01">
          <input id="rotZS-SPD" type="number">
        </div>
      </div>
      <div>
        rotationNode 조절
        <div>
          <input id="rotXDN-N" type="number">
          <input id="rotXSN-N" type="range" min="-6.28" max="6.28" step="0.01">
          <input id="rotXSN-SPD" type="number">
        </div>
        <div>
          <input id="rotYDN-N" type="number">
          <input id="rotYSN-N" type="range" min="-6.28" max="6.28" step="0.01">
          <input id="rotYSN-SPD" type="number">
        </div>
        <div>
          <input id="rotZDN-N" type="number">
          <input id="rotZSN-N" type="range" min="-6.28" max="6.28" step="0.01">
          <input id="rotZSN-SPD" type="number">
        </div>
      </div>
      <div>
        translate 조절
        <div>
          <input id="trXD-N" type="number">
          <button onclick="trNodeFunc(0, 0.1)">
            x축으로 0.1 이동
          </button>
          <button onclick="trNodeFunc(0, -0.1)">
            x축으로 -0.1 이동
          </button>
        </div>
        <div>
          <input id="trYD-N" type="number">
          <button onclick="trNodeFunc(1, 0.1)">
            y축으로 0.1 이동
          </button>
          <button onclick="trNodeFunc(1, -0.1)">
            y축으로 -0.1 이동
          </button>
        </div>
        <div>
          <input id="trZD-N" type="number">
          <button onclick="trNodeFunc(2, 0.1)">
            z축으로 0.1 이동
          </button>
          <button onclick="trNodeFunc(2, -0.1)">
            z축으로 -0.1 이동
          </button>
        </div>
      </div>
      <div>
        scale 조절
        <div>
          <input id="scXD-N" type="number">
          <button onclick="scNodeFunc(0, 0.1)">
            x축 scale 0.1 증가
          </button>
          <button onclick="scNodeFunc(0, -0.1)">
            x축 scale -0.1 증가
          </button>
        </div>
        <div>
          <input id="scYD-N" type="number">
          <button onclick="scNodeFunc(1, 0.1)">
            y축 scale 0.1 증가
          </button>
          <button onclick="scNodeFunc(1, -0.1)">
            y축 scale -0.1 증가
          </button>
        </div>
        <div style="margin-bottom: 20px;">
          <input id="scZD-N" type="number">
          <button onclick="scNodeFunc(2, 0.1)">
            z축 scale 0.1 증가
          </button>
          <button onclick="scNodeFunc(2, -0.1)">
            z축 scale -0.1 증가
          </button>
        </div>
        createNode
        <div>
          <input id="nodeName">
          <input type="radio" name="nodeType" value="cube" onchange="createNodeType = 'cube'" checked>cube
          <input type="radio" name="nodeType" value="sphere" onchange="createNodeType = 'sphere'">sphere
          <input type="radio" name="nodeType" value="tetrahedron" onchange="createNodeType = 'tetrahedron'">tetrahedron
          <button onclick="createNode()">
            create node
          </button>
        </div>
        <div style="margin-top: 20px;">
          children
          <div id="children"></div>
        </div>
      </div>
    </div>
  </div>
  <div style="display: flex;">
    <div>
      rotation 조절
      <div>
        <input id="rotXD" type="number">
        <input id="rotXS" type="range" min="-6.28" max="6.28" step="0.01">
        <input id="rotXSPD" type="number">
      </div>
      <div>
        <input id="rotYD" type="number">
        <input id="rotYS" type="range" min="-6.28" max="6.28" step="0.01">
        <input id="rotYSPD" type="number">
      </div>
      <div>
        <input id="rotZD" type="number">
        <input id="rotZS" type="range" min="-6.28" max="6.28" step="0.01">
        <input id="rotZSPD" type="number">
      </div>
    </div>
    <div style="margin-left: 20px;">
      translate 조절
      <div>
        <input id="trXD" type="number">
        <button onclick="trFunc(0, 0.1)">
          x축으로 0.1 이동
        </button>
        <button onclick="trFunc(0, -0.1)">
          x축으로 -0.1 이동
        </button>
      </div>
      <div>
        <input id="trYD" type="number">
        <button onclick="trFunc(1, 0.1)">
          y축으로 0.1 이동
        </button>
        <button onclick="trFunc(1, -0.1)">
          y축으로 -0.1 이동
        </button>
      </div>
      <div>
        <input id="trZD" type="number">
        <button onclick="trFunc(2, 0.1)">
          z축으로 0.1 이동
        </button>
        <button onclick="trFunc(2, -0.1)">
          z축으로 -0.1 이동
        </button>
      </div>
    </div>
    <div style="margin-left: 20px;">
      scale 조절
      <div>
        <input id="scXD" type="number">
        <button onclick="scFunc(0, 0.1)">
          x축 scale 0.1 증가
        </button>
        <button onclick="scFunc(0, -0.1)">
          x축 scale -0.1 증가
        </button>
      </div>
      <div>
        <input id="scYD" type="number">
        <button onclick="scFunc(1, 0.1)">
          y축 scale 0.1 증가
        </button>
        <button onclick="scFunc(1, -0.1)">
          y축 scale -0.1 증가
        </button>
      </div>
      <div>
        <input id="scZD" type="number">
        <button onclick="scFunc(2, 0.1)">
          z축 scale 0.1 증가
        </button>
        <button onclick="scFunc(2, -0.1)">
          z축 scale -0.1 증가
        </button>
      </div>
    </div>
    <div id="fps">
    </div>
    <div id="finger-ctrl" style="display: none;">
      <button onclick="fingerFunc('th')">
        엄지
      </button>
      <button onclick="fingerFunc('if')">
        검지
      </button>
      <button onclick="fingerFunc('mf')">
        중지
      </button>
      <button onclick="fingerFunc('rf')">
        약지
      </button>
      <button onclick="fingerFunc('pk')">
        소지
      </button>
    </div>
  </div>
  <div class="node-names" id="nodeNames">
  </div>
</body>

</html>